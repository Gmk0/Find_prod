import{g as p,L as R,s as j,o as t,c as o,b as r,r as E,f as a,w as s,t as b,i as u,K as M,k as B,n as x,D as H,Q as N,T as Q,E as D,M as O,e as h,h as c,j as U,u as $,F as G,l as J,O as K}from"./app-3d79ce1e.js";import{b as W,a as X}from"./DialogModal-b2243b30.js";import{_ as A}from"./PrimaryButton-7439e7f9.js";import{_ as C}from"./SecondaryButton-3aa4f4cd.js";import{_ as Y}from"./DangerButton-83faafe2.js";import{_ as Z}from"./TextInput-b8db2b31.js";import"./SectionTitle-8f0ca897.js";const ee={class:"dark:text-gray-50"},te={class:"mt-4"},g={__name:"ConfirmsPassword",props:{title:{type:String,default:"Confirmer le mot de passe"},content:{type:String,default:"Pour des raisons de sécurité, veuillez confirmer votre mot de passe pour continuer."},button:{type:String,default:"Confirmer"}},emits:["confirmed"],setup(y,{emit:S}){const w=S,i=p(!1),e=R({password:"",error:"",processing:!1}),l=p(null),_=()=>{axios.get(route("password.confirmation")).then(n=>{n.data.confirmed?w("confirmed"):(i.value=!0,setTimeout(()=>l.value.focus(),250))})},v=()=>{e.processing=!0,axios.post(route("password.confirm"),{password:e.password}).then(()=>{e.processing=!1,d(),H().then(()=>w("confirmed"))}).catch(n=>{e.processing=!1,e.error=n.response.data.errors.password[0],l.value.focus()})},d=()=>{i.value=!1,e.password="",e.error=""};return(n,f)=>{const z=j("MazInput");return t(),o("span",null,[r("span",{onClick:_},[E(n.$slots,"default")]),a(W,{show:i.value,onClose:d},{title:s(()=>[r("p",ee,b(y.title),1)]),content:s(()=>[u(b(y.content)+" ",1),r("div",te,[a(z,{ref_key:"passwordInput",ref:l,modelValue:e.password,"onUpdate:modelValue":f[0]||(f[0]=T=>e.password=T),type:"password",placeholder:"Password",onKeyup:M(v,["enter"])},null,8,["modelValue"]),a(B,{message:e.error,class:"mt-2"},null,8,["message"])])]),footer:s(()=>[a(C,{onClick:d},{default:s(()=>[u(" Annuler ")]),_:1}),a(A,{class:x(["ml-3",{"opacity-25":e.processing}]),disabled:e.processing,onClick:v},{default:s(()=>[u(b(y.button),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"])])}}},se=r("h1",{class:"dark:text-gray-50"}," L'authentification à deux facteurs ",-1),oe=r("p",{class:"dark:text-gray-50"}," Ajoutez une sécurité supplémentaire à votre compte en utilisant l'authentification à deux facteurs.",-1),ae={key:0,class:"text-lg font-medium text-gray-900 dark:text-white"},re={key:1,class:"text-lg font-medium text-gray-900 dark:text-gray-50"},ne={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-50"},ie=r("div",{class:"max-w-xl mt-3 text-sm text-gray-600 dark:text-gray-50"},[r("p",null," Lorsque l'authentification à deux facteurs est activée, vous serez invité à saisir un jeton aléatoire sécurisé lors de l'authentification. Vous pouvez récupérer ce jeton depuis l'application Google Authenticator de votre téléphone. ")],-1),le={key:3},ce={key:0},ue={class:"max-w-xl mt-4 text-sm text-gray-600 dark:text-gray-200"},de={key:0,class:"font-semibold"},fe={key:1},me=["innerHTML"],pe={key:0,class:"max-w-xl mt-4 text-sm text-gray-600"},ve={class:"font-semibold"},_e=["innerHTML"],he={key:1,class:"mt-4"},ge={key:1},ye=r("div",{class:"max-w-xl mt-4 text-sm text-gray-600 dark:text-gray-200"},[r("p",{class:"font-semibold"}," Stockez ces codes de récupération dans un gestionnaire de mots de passe sécurisé. Ils peuvent être utilisés pour récupérer l'accès à votre compte si votre appareil d'authentification à deux facteurs est perdu. ")],-1),xe={class:"grid max-w-xl gap-1 px-4 py-4 mt-4 font-mono text-sm bg-gray-100 rounded-lg dark:bg-gray-800"},we={class:"mt-5"},ke={key:0},be={key:1},Fe={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(y){const S=y,w=N(),i=p(!1),e=p(!1),l=p(!1),_=p(null),v=p(null),d=p([]),n=Q({code:""}),f=D(()=>{var m;return!i.value&&((m=w.props.auth.user)==null?void 0:m.two_factor_enabled)});O(f,()=>{f.value||(n.reset(),n.clearErrors())});const z=()=>{i.value=!0,K.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>Promise.all([T(),q(),V()]),onFinish:()=>{i.value=!1,e.value=S.requiresConfirmation}})},T=()=>axios.get(route("two-factor.qr-code")).then(m=>{_.value=m.data.svg}),q=()=>axios.get(route("two-factor.secret-key")).then(m=>{v.value=m.data.secretKey}),V=()=>axios.get(route("two-factor.recovery-codes")).then(m=>{d.value=m.data}),F=()=>{n.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{e.value=!1,_.value=null,v.value=null}})},I=()=>{axios.post(route("two-factor.recovery-codes")).then(()=>V())},L=()=>{l.value=!0,K.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{l.value=!1,e.value=!1}})};return(m,P)=>(t(),h(X,null,{title:s(()=>[se]),description:s(()=>[oe]),content:s(()=>[f.value&&!e.value?(t(),o("h3",ae," Vous avez activé l'authentification à deux facteurs. ")):f.value&&e.value?(t(),o("h3",re," Terminer l'activation de l'authentification à deux facteurs.. ")):(t(),o("h3",ne," Vous n'avez pas activé l'authentification à deux facteurs. ")),ie,f.value?(t(),o("div",le,[_.value?(t(),o("div",ce,[r("div",ue,[e.value?(t(),o("p",de," Pour finaliser l'activation de l'authentification à deux facteurs, scannez le code QR suivant en utilisant l'application d'authentification de votre téléphone ou saisissez la clé de configuration et fournissez le code OTP généré. ")):(t(),o("p",fe," L'authentification à deux facteurs est désormais activée. Scannez le code QR suivant en utilisant l'application d'authentification de votre téléphone ou saisissez la clé de configuration. "))]),r("div",{class:"inline-block p-2 mt-4 bg-white",innerHTML:_.value},null,8,me),v.value?(t(),o("div",pe,[r("p",ve,[u(" Setup Key: "),r("span",{innerHTML:v.value},null,8,_e)])])):c("",!0),e.value?(t(),o("div",he,[a(U,{for:"code",value:"Code"}),a(Z,{id:"code",modelValue:$(n).code,"onUpdate:modelValue":P[0]||(P[0]=k=>$(n).code=k),type:"text",name:"code",class:"block w-1/2 mt-1",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:M(F,["enter"])},null,8,["modelValue"]),a(B,{message:$(n).errors.code,class:"mt-2"},null,8,["message"])])):c("",!0)])):c("",!0),d.value.length>0&&!e.value?(t(),o("div",ge,[ye,r("div",xe,[(t(!0),o(G,null,J(d.value,k=>(t(),o("div",{key:k},b(k),1))),128))])])):c("",!0)])):c("",!0),r("div",we,[f.value?(t(),o("div",be,[a(g,{onConfirmed:F},{default:s(()=>[e.value?(t(),h(A,{key:0,type:"button",class:x(["mr-3",{"opacity-25":i.value}]),disabled:i.value},{default:s(()=>[u(" Confirm ")]),_:1},8,["class","disabled"])):c("",!0)]),_:1}),a(g,{onConfirmed:I},{default:s(()=>[d.value.length>0&&!e.value?(t(),h(C,{key:0,class:"mr-3"},{default:s(()=>[u(" Régénérer les codes de récupération ")]),_:1})):c("",!0)]),_:1}),a(g,{onConfirmed:V},{default:s(()=>[d.value.length===0&&!e.value?(t(),h(C,{key:0,class:"mr-3"},{default:s(()=>[u(" Afficher les codes de récupération ")]),_:1})):c("",!0)]),_:1}),a(g,{onConfirmed:L},{default:s(()=>[e.value?(t(),h(C,{key:0,class:x({"opacity-25":l.value}),disabled:l.value},{default:s(()=>[u(" Annuler ")]),_:1},8,["class","disabled"])):c("",!0)]),_:1}),a(g,{onConfirmed:L},{default:s(()=>[e.value?c("",!0):(t(),h(Y,{key:0,class:x({"opacity-25":l.value}),disabled:l.value},{default:s(()=>[u(" Desactiver ")]),_:1},8,["class","disabled"]))]),_:1})])):(t(),o("div",ke,[a(g,{onConfirmed:z},{default:s(()=>[a(A,{type:"button",class:x({"opacity-25":i.value}),disabled:i.value},{default:s(()=>[u(" Activer ")]),_:1},8,["class","disabled"])]),_:1})]))])]),_:1}))}};export{Fe as default};
